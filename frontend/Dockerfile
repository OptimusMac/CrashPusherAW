FROM node:20-alpine AS build
WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN chmod -R 755 node_modules/.bin

# üëá –ü–ï–†–ï–î–ê–ï–ú –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ü–†–ò –ë–ò–õ–î–ï
ARG VITE_API_BASE=http://localhost:8081/api
ENV VITE_API_BASE=$VITE_API_BASE

RUN echo "üîÑ Building with VITE_API_BASE: $VITE_API_BASE"

RUN npm run build

FROM nginx:alpine

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º envsubst
RUN apk add --no-cache gettext

# –ö–æ–ø–∏—Ä—É–µ–º –±–∏–ª–¥
COPY --from=build /app/dist /usr/share/nginx/html

# –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω nginx –∫–æ–Ω—Ñ–∏–≥–∞
COPY nginx.conf.template /etc/nginx/nginx.conf.template

# –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

EXPOSE ${FRONTEND_PORT}

CMD ["/docker-entrypoint.sh"]